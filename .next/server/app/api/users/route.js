"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/users/route";
exports.ids = ["app/api/users/route"];
exports.modules = {

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fusers%2Froute&page=%2Fapi%2Fusers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fusers%2Froute.ts&appDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fusers%2Froute&page=%2Fapi%2Fusers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fusers%2Froute.ts&appDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   headerHooks: () => (/* binding */ headerHooks),\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage),\n/* harmony export */   staticGenerationBailout: () => (/* binding */ staticGenerationBailout)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_chakrinaidu_Desktop_Gethomerealty_production_app_api_users_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/users/route.ts */ \"(rsc)/./app/api/users/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/users/route\",\n        pathname: \"/api/users\",\n        filename: \"route\",\n        bundlePath: \"app/api/users/route\"\n    },\n    resolvedPagePath: \"/Users/chakrinaidu/Desktop/Gethomerealty-production/app/api/users/route.ts\",\n    nextConfigOutput,\n    userland: _Users_chakrinaidu_Desktop_Gethomerealty_production_app_api_users_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks, headerHooks, staticGenerationBailout } = routeModule;\nconst originalPathname = \"/api/users/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ1c2VycyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGdXNlcnMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ1c2VycyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNoYWtyaW5haWR1JTJGRGVza3RvcCUyRkdldGhvbWVyZWFsdHktcHJvZHVjdGlvbiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZjaGFrcmluYWlkdSUyRkRlc2t0b3AlMkZHZXRob21lcmVhbHR5LXByb2R1Y3Rpb24maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9c3RhbmRhbG9uZSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQzBCO0FBQ3ZHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsdUdBQXVHO0FBQy9HO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDNko7O0FBRTdKIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8/M2UzOSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvY2hha3JpbmFpZHUvRGVza3RvcC9HZXRob21lcmVhbHR5LXByb2R1Y3Rpb24vYXBwL2FwaS91c2Vycy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJzdGFuZGFsb25lXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3VzZXJzL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdXNlcnNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3VzZXJzL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2NoYWtyaW5haWR1L0Rlc2t0b3AvR2V0aG9tZXJlYWx0eS1wcm9kdWN0aW9uL2FwcC9hcGkvdXNlcnMvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0IH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvdXNlcnMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgaGVhZGVySG9va3MsIHN0YXRpY0dlbmVyYXRpb25CYWlsb3V0LCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fusers%2Froute&page=%2Fapi%2Fusers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fusers%2Froute.ts&appDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/users/route.ts":
/*!********************************!*\
  !*** ./app/api/users/route.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/web/exports/next-response */ \"(rsc)/./node_modules/next/dist/server/web/exports/next-response.js\");\n/* harmony import */ var _lib_mongodb__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mongodb */ \"(rsc)/./lib/mongodb.ts\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_3__);\n\n\n\n\nconst defaultPermissions = {\n    dashboard: false,\n    leads: false,\n    calendar: false,\n    email: false,\n    settings: false,\n    inventory: false,\n    favorites: false,\n    mls: false\n};\nasync function GET() {\n    try {\n        const { db } = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n        const users = await db.collection(\"users\").find({}).toArray();\n        // Ensure each user has permissions and remove password from response\n        const usersWithPermissions = users.map((user)=>({\n                ...user,\n                permissions: user.permissions || defaultPermissions,\n                password: undefined // Remove password from response\n            }));\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json(usersWithPermissions);\n    } catch (error) {\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to fetch users\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function POST(request) {\n    try {\n        const { db } = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n        const userData = await request.json();\n        // Validate required fields\n        if (!userData.email || !userData.password || !userData.name) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Missing required fields\"\n            }, {\n                status: 400\n            });\n        }\n        // Check if email already exists\n        const existingUser = await db.collection(\"users\").findOne({\n            email: {\n                $regex: new RegExp(`^${userData.email}$`, \"i\")\n            }\n        });\n        if (existingUser) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Email already exists\"\n            }, {\n                status: 400\n            });\n        }\n        // Ensure role is set and normalize it\n        if (!userData.role) {\n            userData.role = \"User\";\n        }\n        // Normalize role to proper case\n        userData.role = userData.role.toLowerCase();\n        if (userData.role === \"admin\" || userData.role === \"administrator\" || userData.role === \"Administrator\") {\n            userData.role = \"Administrator\";\n            // Set admin permissions - always full permissions for admin\n            userData.permissions = {\n                dashboard: true,\n                leads: true,\n                calendar: true,\n                email: true,\n                settings: true,\n                inventory: true,\n                favorites: true,\n                mls: true\n            };\n            console.log(\"Setting admin role and permissions:\", {\n                role: userData.role,\n                permissions: userData.permissions\n            });\n        } else {\n            userData.role = userData.role.charAt(0).toUpperCase() + userData.role.slice(1); // Capitalize first letter\n            // Use provided permissions or default for non-admin users\n            userData.permissions = {\n                dashboard: userData.permissions?.dashboard ?? defaultPermissions.dashboard,\n                leads: userData.permissions?.leads ?? defaultPermissions.leads,\n                calendar: userData.permissions?.calendar ?? defaultPermissions.calendar,\n                email: userData.permissions?.email ?? defaultPermissions.email,\n                settings: userData.permissions?.settings ?? defaultPermissions.settings,\n                inventory: userData.permissions?.inventory ?? defaultPermissions.inventory,\n                favorites: userData.permissions?.favorites ?? defaultPermissions.favorites,\n                mls: userData.permissions?.mls ?? defaultPermissions.mls\n            };\n            console.log(\"Setting non-admin role and permissions:\", {\n                role: userData.role,\n                permissions: userData.permissions\n            });\n        }\n        // Ensure status is set\n        userData.status = userData.status || \"active\";\n        // Add timestamps\n        userData.createdAt = new Date().toISOString();\n        userData.updatedAt = new Date().toISOString();\n        // Hash password\n        const salt = await bcryptjs__WEBPACK_IMPORTED_MODULE_3___default().genSalt(10);\n        userData.password = await bcryptjs__WEBPACK_IMPORTED_MODULE_3___default().hash(userData.password, salt);\n        console.log(\"Creating user:\", {\n            ...userData,\n            password: \"[HIDDEN]\"\n        }); // Debug log\n        const result = await db.collection(\"users\").insertOne(userData);\n        if (!result.insertedId) {\n            throw new Error(\"Failed to create user\");\n        }\n        // Return created user without password\n        const { password, ...userWithoutPassword } = userData;\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            user: {\n                ...userWithoutPassword,\n                _id: result.insertedId\n            }\n        });\n    } catch (error) {\n        console.error(\"Error creating user:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to create user\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function PUT(request) {\n    try {\n        const { db } = await (0,_lib_mongodb__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n        const { id, ...updateData } = await request.json();\n        // Validate user exists\n        const existingUser = await db.collection(\"users\").findOne({\n            _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(id)\n        });\n        if (!existingUser) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"User not found\"\n            }, {\n                status: 404\n            });\n        }\n        // If password is provided, hash it\n        if (updateData.password) {\n            const salt = await bcryptjs__WEBPACK_IMPORTED_MODULE_3___default().genSalt(10);\n            updateData.password = await bcryptjs__WEBPACK_IMPORTED_MODULE_3___default().hash(updateData.password, salt);\n        } else {\n            // Remove password field if not provided to keep existing password\n            delete updateData.password;\n        }\n        // Update timestamp\n        updateData.updatedAt = new Date().toISOString();\n        // Handle role changes and permissions\n        if (updateData.role) {\n            // Normalize role to proper case\n            updateData.role = updateData.role.toLowerCase();\n            console.log(\"Role update requested:\", {\n                newRole: updateData.role\n            });\n            if (updateData.role === \"admin\" || updateData.role === \"administrator\") {\n                updateData.role = \"Administrator\";\n                // Set admin permissions - always full permissions for admin\n                updateData.permissions = {\n                    dashboard: true,\n                    leads: true,\n                    calendar: true,\n                    email: true,\n                    settings: true,\n                    inventory: true,\n                    favorites: true,\n                    mls: true\n                };\n                console.log(\"Updated to admin role:\", {\n                    role: updateData.role,\n                    permissions: updateData.permissions\n                });\n            } else {\n                updateData.role = updateData.role.charAt(0).toUpperCase() + updateData.role.slice(1); // Capitalize first letter\n                // Keep existing permissions if not explicitly provided in update\n                if (updateData.permissions) {\n                    updateData.permissions = {\n                        dashboard: updateData.permissions.dashboard ?? existingUser.permissions?.dashboard ?? defaultPermissions.dashboard,\n                        leads: updateData.permissions.leads ?? existingUser.permissions?.leads ?? defaultPermissions.leads,\n                        calendar: updateData.permissions.calendar ?? existingUser.permissions?.calendar ?? defaultPermissions.calendar,\n                        email: updateData.permissions.email ?? existingUser.permissions?.email ?? defaultPermissions.email,\n                        settings: updateData.permissions.settings ?? existingUser.permissions?.settings ?? defaultPermissions.settings,\n                        inventory: updateData.permissions.inventory ?? existingUser.permissions?.inventory ?? defaultPermissions.inventory,\n                        favorites: updateData.permissions.favorites ?? existingUser.permissions?.favorites ?? defaultPermissions.favorites,\n                        mls: updateData.permissions.mls ?? existingUser.permissions?.mls ?? defaultPermissions.mls\n                    };\n                }\n            }\n        } else if (updateData.permissions) {\n            // Handle permission updates without role change\n            updateData.permissions = {\n                dashboard: updateData.permissions.dashboard ?? existingUser.permissions?.dashboard ?? defaultPermissions.dashboard,\n                leads: updateData.permissions.leads ?? existingUser.permissions?.leads ?? defaultPermissions.leads,\n                calendar: updateData.permissions.calendar ?? existingUser.permissions?.calendar ?? defaultPermissions.calendar,\n                email: updateData.permissions.email ?? existingUser.permissions?.email ?? defaultPermissions.email,\n                settings: updateData.permissions.settings ?? existingUser.permissions?.settings ?? defaultPermissions.settings,\n                inventory: updateData.permissions.inventory ?? existingUser.permissions?.inventory ?? defaultPermissions.inventory,\n                favorites: updateData.permissions.favorites ?? existingUser.permissions?.favorites ?? defaultPermissions.favorites,\n                mls: updateData.permissions.mls ?? existingUser.permissions?.mls ?? defaultPermissions.mls\n            };\n        }\n        const result = await db.collection(\"users\").updateOne({\n            _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(id)\n        }, {\n            $set: updateData\n        });\n        if (result.matchedCount === 0) {\n            return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n                error: \"Failed to update user\"\n            }, {\n                status: 500\n            });\n        }\n        // Return updated user without password\n        const updatedUser = await db.collection(\"users\").findOne({\n            _id: new mongodb__WEBPACK_IMPORTED_MODULE_2__.ObjectId(id)\n        }, {\n            projection: {\n                password: 0\n            }\n        });\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            success: true,\n            user: updatedUser\n        });\n    } catch (error) {\n        console.error(\"Error updating user:\", error);\n        return next_dist_server_web_exports_next_response__WEBPACK_IMPORTED_MODULE_0__[\"default\"].json({\n            error: \"Failed to update user\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QSxDQUFDeUIsSUFBSSxDQUN0QjtZQUFFQyxPQUFPO1FBQXdCLEdBQ2pDO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2FwcC9hcGkvdXNlcnMvcm91dGUudHM/N2ZiMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgeyBjb25uZWN0VG9EYXRhYmFzZSB9IGZyb20gXCJAL2xpYi9tb25nb2RiXCI7XG5pbXBvcnQgeyBPYmplY3RJZCB9IGZyb20gXCJtb25nb2RiXCI7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcblxuY29uc3QgZGVmYXVsdFBlcm1pc3Npb25zID0ge1xuICBkYXNoYm9hcmQ6IGZhbHNlLFxuICBsZWFkczogZmFsc2UsXG4gIGNhbGVuZGFyOiBmYWxzZSxcbiAgZW1haWw6IGZhbHNlLFxuICBzZXR0aW5nczogZmFsc2UsXG4gIGludmVudG9yeTogZmFsc2UsXG4gIGZhdm9yaXRlczogZmFsc2UsXG4gIG1sczogZmFsc2Vcbn07XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKS5maW5kKHt9KS50b0FycmF5KCk7XG4gICAgXG4gICAgLy8gRW5zdXJlIGVhY2ggdXNlciBoYXMgcGVybWlzc2lvbnMgYW5kIHJlbW92ZSBwYXNzd29yZCBmcm9tIHJlc3BvbnNlXG4gICAgY29uc3QgdXNlcnNXaXRoUGVybWlzc2lvbnMgPSB1c2Vycy5tYXAodXNlciA9PiAoe1xuICAgICAgLi4udXNlcixcbiAgICAgIHBlcm1pc3Npb25zOiB1c2VyLnBlcm1pc3Npb25zIHx8IGRlZmF1bHRQZXJtaXNzaW9ucyxcbiAgICAgIHBhc3N3b3JkOiB1bmRlZmluZWQgLy8gUmVtb3ZlIHBhc3N3b3JkIGZyb20gcmVzcG9uc2VcbiAgICB9KSk7XG4gICAgXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHVzZXJzV2l0aFBlcm1pc3Npb25zKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJGYWlsZWQgdG8gZmV0Y2ggdXNlcnNcIiB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRiIH0gPSBhd2FpdCBjb25uZWN0VG9EYXRhYmFzZSgpO1xuICAgIGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XG5cbiAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICBpZiAoIXVzZXJEYXRhLmVtYWlsIHx8ICF1c2VyRGF0YS5wYXNzd29yZCB8fCAhdXNlckRhdGEubmFtZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBcIk1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGVtYWlsIGFscmVhZHkgZXhpc3RzXG4gICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbihcInVzZXJzXCIpLmZpbmRPbmUoe1xuICAgICAgZW1haWw6IHsgJHJlZ2V4OiBuZXcgUmVnRXhwKGBeJHt1c2VyRGF0YS5lbWFpbH0kYCwgJ2knKSB9XG4gICAgfSk7XG5cbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IFwiRW1haWwgYWxyZWFkeSBleGlzdHNcIiB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIHJvbGUgaXMgc2V0IGFuZCBub3JtYWxpemUgaXRcbiAgICBpZiAoIXVzZXJEYXRhLnJvbGUpIHtcbiAgICAgIHVzZXJEYXRhLnJvbGUgPSBcIlVzZXJcIjtcbiAgICB9XG5cbiAgICAvLyBOb3JtYWxpemUgcm9sZSB0byBwcm9wZXIgY2FzZVxuICAgIHVzZXJEYXRhLnJvbGUgPSB1c2VyRGF0YS5yb2xlLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKHVzZXJEYXRhLnJvbGUgPT09IFwiYWRtaW5cIiB8fCB1c2VyRGF0YS5yb2xlID09PSBcImFkbWluaXN0cmF0b3JcIiB8fCB1c2VyRGF0YS5yb2xlID09PSBcIkFkbWluaXN0cmF0b3JcIikge1xuICAgICAgdXNlckRhdGEucm9sZSA9IFwiQWRtaW5pc3RyYXRvclwiO1xuICAgICAgLy8gU2V0IGFkbWluIHBlcm1pc3Npb25zIC0gYWx3YXlzIGZ1bGwgcGVybWlzc2lvbnMgZm9yIGFkbWluXG4gICAgICB1c2VyRGF0YS5wZXJtaXNzaW9ucyA9IHtcbiAgICAgICAgZGFzaGJvYXJkOiB0cnVlLFxuICAgICAgICBsZWFkczogdHJ1ZSxcbiAgICAgICAgY2FsZW5kYXI6IHRydWUsXG4gICAgICAgIGVtYWlsOiB0cnVlLFxuICAgICAgICBzZXR0aW5nczogdHJ1ZSxcbiAgICAgICAgaW52ZW50b3J5OiB0cnVlLFxuICAgICAgICBmYXZvcml0ZXM6IHRydWUsXG4gICAgICAgIG1sczogdHJ1ZVxuICAgICAgfTtcbiAgICAgIGNvbnNvbGUubG9nKFwiU2V0dGluZyBhZG1pbiByb2xlIGFuZCBwZXJtaXNzaW9uczpcIiwgeyByb2xlOiB1c2VyRGF0YS5yb2xlLCBwZXJtaXNzaW9uczogdXNlckRhdGEucGVybWlzc2lvbnMgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVzZXJEYXRhLnJvbGUgPSB1c2VyRGF0YS5yb2xlLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgdXNlckRhdGEucm9sZS5zbGljZSgxKTsgLy8gQ2FwaXRhbGl6ZSBmaXJzdCBsZXR0ZXJcbiAgICAgIC8vIFVzZSBwcm92aWRlZCBwZXJtaXNzaW9ucyBvciBkZWZhdWx0IGZvciBub24tYWRtaW4gdXNlcnNcbiAgICAgIHVzZXJEYXRhLnBlcm1pc3Npb25zID0ge1xuICAgICAgICBkYXNoYm9hcmQ6IHVzZXJEYXRhLnBlcm1pc3Npb25zPy5kYXNoYm9hcmQgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmRhc2hib2FyZCxcbiAgICAgICAgbGVhZHM6IHVzZXJEYXRhLnBlcm1pc3Npb25zPy5sZWFkcyA/PyBkZWZhdWx0UGVybWlzc2lvbnMubGVhZHMsXG4gICAgICAgIGNhbGVuZGFyOiB1c2VyRGF0YS5wZXJtaXNzaW9ucz8uY2FsZW5kYXIgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmNhbGVuZGFyLFxuICAgICAgICBlbWFpbDogdXNlckRhdGEucGVybWlzc2lvbnM/LmVtYWlsID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5lbWFpbCxcbiAgICAgICAgc2V0dGluZ3M6IHVzZXJEYXRhLnBlcm1pc3Npb25zPy5zZXR0aW5ncyA/PyBkZWZhdWx0UGVybWlzc2lvbnMuc2V0dGluZ3MsXG4gICAgICAgIGludmVudG9yeTogdXNlckRhdGEucGVybWlzc2lvbnM/LmludmVudG9yeSA/PyBkZWZhdWx0UGVybWlzc2lvbnMuaW52ZW50b3J5LFxuICAgICAgICBmYXZvcml0ZXM6IHVzZXJEYXRhLnBlcm1pc3Npb25zPy5mYXZvcml0ZXMgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmZhdm9yaXRlcyxcbiAgICAgICAgbWxzOiB1c2VyRGF0YS5wZXJtaXNzaW9ucz8ubWxzID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5tbHNcbiAgICAgIH07XG4gICAgICBjb25zb2xlLmxvZyhcIlNldHRpbmcgbm9uLWFkbWluIHJvbGUgYW5kIHBlcm1pc3Npb25zOlwiLCB7IHJvbGU6IHVzZXJEYXRhLnJvbGUsIHBlcm1pc3Npb25zOiB1c2VyRGF0YS5wZXJtaXNzaW9ucyB9KTtcbiAgICB9XG5cbiAgICAvLyBFbnN1cmUgc3RhdHVzIGlzIHNldFxuICAgIHVzZXJEYXRhLnN0YXR1cyA9IHVzZXJEYXRhLnN0YXR1cyB8fCBcImFjdGl2ZVwiO1xuXG4gICAgLy8gQWRkIHRpbWVzdGFtcHNcbiAgICB1c2VyRGF0YS5jcmVhdGVkQXQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgdXNlckRhdGEudXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG4gICAgLy8gSGFzaCBwYXNzd29yZFxuICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMCk7XG4gICAgdXNlckRhdGEucGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaCh1c2VyRGF0YS5wYXNzd29yZCwgc2FsdCk7XG5cbiAgICBjb25zb2xlLmxvZyhcIkNyZWF0aW5nIHVzZXI6XCIsIHsgLi4udXNlckRhdGEsIHBhc3N3b3JkOiAnW0hJRERFTl0nIH0pOyAvLyBEZWJ1ZyBsb2dcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKS5pbnNlcnRPbmUodXNlckRhdGEpO1xuXG4gICAgaWYgKCFyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSB1c2VyXCIpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiBjcmVhdGVkIHVzZXIgd2l0aG91dCBwYXNzd29yZFxuICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXJEYXRhO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgdXNlcjoge1xuICAgICAgICAuLi51c2VyV2l0aG91dFBhc3N3b3JkLFxuICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgfSxcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY3JlYXRpbmcgdXNlcjpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGNyZWF0ZSB1c2VyXCIgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBVVChyZXF1ZXN0OiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYiB9ID0gYXdhaXQgY29ubmVjdFRvRGF0YWJhc2UoKTtcbiAgICBjb25zdCB7IGlkLCAuLi51cGRhdGVEYXRhIH0gPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcblxuICAgIC8vIFZhbGlkYXRlIHVzZXIgZXhpc3RzXG4gICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbihcInVzZXJzXCIpLmZpbmRPbmUoe1xuICAgICAgX2lkOiBuZXcgT2JqZWN0SWQoaWQpXG4gICAgfSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nVXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBcIlVzZXIgbm90IGZvdW5kXCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwNCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIElmIHBhc3N3b3JkIGlzIHByb3ZpZGVkLCBoYXNoIGl0XG4gICAgaWYgKHVwZGF0ZURhdGEucGFzc3dvcmQpIHtcbiAgICAgIGNvbnN0IHNhbHQgPSBhd2FpdCBiY3J5cHQuZ2VuU2FsdCgxMCk7XG4gICAgICB1cGRhdGVEYXRhLnBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2godXBkYXRlRGF0YS5wYXNzd29yZCwgc2FsdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlbW92ZSBwYXNzd29yZCBmaWVsZCBpZiBub3QgcHJvdmlkZWQgdG8ga2VlcCBleGlzdGluZyBwYXNzd29yZFxuICAgICAgZGVsZXRlIHVwZGF0ZURhdGEucGFzc3dvcmQ7XG4gICAgfVxuXG4gICAgLy8gVXBkYXRlIHRpbWVzdGFtcFxuICAgIHVwZGF0ZURhdGEudXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG4gICAgLy8gSGFuZGxlIHJvbGUgY2hhbmdlcyBhbmQgcGVybWlzc2lvbnNcbiAgICBpZiAodXBkYXRlRGF0YS5yb2xlKSB7XG4gICAgICAvLyBOb3JtYWxpemUgcm9sZSB0byBwcm9wZXIgY2FzZVxuICAgICAgdXBkYXRlRGF0YS5yb2xlID0gdXBkYXRlRGF0YS5yb2xlLnRvTG93ZXJDYXNlKCk7XG4gICAgICBjb25zb2xlLmxvZyhcIlJvbGUgdXBkYXRlIHJlcXVlc3RlZDpcIiwgeyBuZXdSb2xlOiB1cGRhdGVEYXRhLnJvbGUgfSk7XG4gICAgICBcbiAgICAgIGlmICh1cGRhdGVEYXRhLnJvbGUgPT09IFwiYWRtaW5cIiB8fCB1cGRhdGVEYXRhLnJvbGUgPT09IFwiYWRtaW5pc3RyYXRvclwiKSB7XG4gICAgICAgIHVwZGF0ZURhdGEucm9sZSA9IFwiQWRtaW5pc3RyYXRvclwiO1xuICAgICAgICAvLyBTZXQgYWRtaW4gcGVybWlzc2lvbnMgLSBhbHdheXMgZnVsbCBwZXJtaXNzaW9ucyBmb3IgYWRtaW5cbiAgICAgICAgdXBkYXRlRGF0YS5wZXJtaXNzaW9ucyA9IHtcbiAgICAgICAgICBkYXNoYm9hcmQ6IHRydWUsXG4gICAgICAgICAgbGVhZHM6IHRydWUsXG4gICAgICAgICAgY2FsZW5kYXI6IHRydWUsXG4gICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgICAgc2V0dGluZ3M6IHRydWUsXG4gICAgICAgICAgaW52ZW50b3J5OiB0cnVlLFxuICAgICAgICAgIGZhdm9yaXRlczogdHJ1ZSxcbiAgICAgICAgICBtbHM6IHRydWVcbiAgICAgICAgfTtcbiAgICAgICAgY29uc29sZS5sb2coXCJVcGRhdGVkIHRvIGFkbWluIHJvbGU6XCIsIHsgcm9sZTogdXBkYXRlRGF0YS5yb2xlLCBwZXJtaXNzaW9uczogdXBkYXRlRGF0YS5wZXJtaXNzaW9ucyB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVwZGF0ZURhdGEucm9sZSA9IHVwZGF0ZURhdGEucm9sZS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHVwZGF0ZURhdGEucm9sZS5zbGljZSgxKTsgLy8gQ2FwaXRhbGl6ZSBmaXJzdCBsZXR0ZXJcbiAgICAgICAgLy8gS2VlcCBleGlzdGluZyBwZXJtaXNzaW9ucyBpZiBub3QgZXhwbGljaXRseSBwcm92aWRlZCBpbiB1cGRhdGVcbiAgICAgICAgaWYgKHVwZGF0ZURhdGEucGVybWlzc2lvbnMpIHtcbiAgICAgICAgICB1cGRhdGVEYXRhLnBlcm1pc3Npb25zID0ge1xuICAgICAgICAgICAgZGFzaGJvYXJkOiB1cGRhdGVEYXRhLnBlcm1pc3Npb25zLmRhc2hib2FyZCA/PyBleGlzdGluZ1VzZXIucGVybWlzc2lvbnM/LmRhc2hib2FyZCA/PyBkZWZhdWx0UGVybWlzc2lvbnMuZGFzaGJvYXJkLFxuICAgICAgICAgICAgbGVhZHM6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMubGVhZHMgPz8gZXhpc3RpbmdVc2VyLnBlcm1pc3Npb25zPy5sZWFkcyA/PyBkZWZhdWx0UGVybWlzc2lvbnMubGVhZHMsXG4gICAgICAgICAgICBjYWxlbmRhcjogdXBkYXRlRGF0YS5wZXJtaXNzaW9ucy5jYWxlbmRhciA/PyBleGlzdGluZ1VzZXIucGVybWlzc2lvbnM/LmNhbGVuZGFyID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5jYWxlbmRhcixcbiAgICAgICAgICAgIGVtYWlsOiB1cGRhdGVEYXRhLnBlcm1pc3Npb25zLmVtYWlsID8/IGV4aXN0aW5nVXNlci5wZXJtaXNzaW9ucz8uZW1haWwgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmVtYWlsLFxuICAgICAgICAgICAgc2V0dGluZ3M6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMuc2V0dGluZ3MgPz8gZXhpc3RpbmdVc2VyLnBlcm1pc3Npb25zPy5zZXR0aW5ncyA/PyBkZWZhdWx0UGVybWlzc2lvbnMuc2V0dGluZ3MsXG4gICAgICAgICAgICBpbnZlbnRvcnk6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMuaW52ZW50b3J5ID8/IGV4aXN0aW5nVXNlci5wZXJtaXNzaW9ucz8uaW52ZW50b3J5ID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5pbnZlbnRvcnksXG4gICAgICAgICAgICBmYXZvcml0ZXM6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMuZmF2b3JpdGVzID8/IGV4aXN0aW5nVXNlci5wZXJtaXNzaW9ucz8uZmF2b3JpdGVzID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5mYXZvcml0ZXMsXG4gICAgICAgICAgICBtbHM6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMubWxzID8/IGV4aXN0aW5nVXNlci5wZXJtaXNzaW9ucz8ubWxzID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5tbHNcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh1cGRhdGVEYXRhLnBlcm1pc3Npb25zKSB7XG4gICAgICAvLyBIYW5kbGUgcGVybWlzc2lvbiB1cGRhdGVzIHdpdGhvdXQgcm9sZSBjaGFuZ2VcbiAgICAgIHVwZGF0ZURhdGEucGVybWlzc2lvbnMgPSB7XG4gICAgICAgIGRhc2hib2FyZDogdXBkYXRlRGF0YS5wZXJtaXNzaW9ucy5kYXNoYm9hcmQgPz8gZXhpc3RpbmdVc2VyLnBlcm1pc3Npb25zPy5kYXNoYm9hcmQgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmRhc2hib2FyZCxcbiAgICAgICAgbGVhZHM6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMubGVhZHMgPz8gZXhpc3RpbmdVc2VyLnBlcm1pc3Npb25zPy5sZWFkcyA/PyBkZWZhdWx0UGVybWlzc2lvbnMubGVhZHMsXG4gICAgICAgIGNhbGVuZGFyOiB1cGRhdGVEYXRhLnBlcm1pc3Npb25zLmNhbGVuZGFyID8/IGV4aXN0aW5nVXNlci5wZXJtaXNzaW9ucz8uY2FsZW5kYXIgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmNhbGVuZGFyLFxuICAgICAgICBlbWFpbDogdXBkYXRlRGF0YS5wZXJtaXNzaW9ucy5lbWFpbCA/PyBleGlzdGluZ1VzZXIucGVybWlzc2lvbnM/LmVtYWlsID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5lbWFpbCxcbiAgICAgICAgc2V0dGluZ3M6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMuc2V0dGluZ3MgPz8gZXhpc3RpbmdVc2VyLnBlcm1pc3Npb25zPy5zZXR0aW5ncyA/PyBkZWZhdWx0UGVybWlzc2lvbnMuc2V0dGluZ3MsXG4gICAgICAgIGludmVudG9yeTogdXBkYXRlRGF0YS5wZXJtaXNzaW9ucy5pbnZlbnRvcnkgPz8gZXhpc3RpbmdVc2VyLnBlcm1pc3Npb25zPy5pbnZlbnRvcnkgPz8gZGVmYXVsdFBlcm1pc3Npb25zLmludmVudG9yeSxcbiAgICAgICAgZmF2b3JpdGVzOiB1cGRhdGVEYXRhLnBlcm1pc3Npb25zLmZhdm9yaXRlcyA/PyBleGlzdGluZ1VzZXIucGVybWlzc2lvbnM/LmZhdm9yaXRlcyA/PyBkZWZhdWx0UGVybWlzc2lvbnMuZmF2b3JpdGVzLFxuICAgICAgICBtbHM6IHVwZGF0ZURhdGEucGVybWlzc2lvbnMubWxzID8/IGV4aXN0aW5nVXNlci5wZXJtaXNzaW9ucz8ubWxzID8/IGRlZmF1bHRQZXJtaXNzaW9ucy5tbHNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuY29sbGVjdGlvbihcInVzZXJzXCIpLnVwZGF0ZU9uZShcbiAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoaWQpIH0sXG4gICAgICB7ICRzZXQ6IHVwZGF0ZURhdGEgfVxuICAgICk7XG5cbiAgICBpZiAocmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiBcIkZhaWxlZCB0byB1cGRhdGUgdXNlclwiIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdXBkYXRlZCB1c2VyIHdpdGhvdXQgcGFzc3dvcmRcbiAgICBjb25zdCB1cGRhdGVkVXNlciA9IGF3YWl0IGRiLmNvbGxlY3Rpb24oXCJ1c2Vyc1wiKS5maW5kT25lKFxuICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChpZCkgfSxcbiAgICAgIHsgcHJvamVjdGlvbjogeyBwYXNzd29yZDogMCB9IH1cbiAgICApO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB1c2VyOiB1cGRhdGVkVXNlclxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1cGRhdGluZyB1c2VyOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogXCJGYWlsZWQgdG8gdXBkYXRlIHVzZXJcIiB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufSAiXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiY29ubmVjdFRvRGF0YWJhc2UiLCJPYmplY3RJZCIsImJjcnlwdCIsImRlZmF1bHRQZXJtaXNzaW9ucyIsImRhc2hib2FyZCIsImxlYWRzIiwiY2FsZW5kYXIiLCJlbWFpbCIsInNldHRpbmdzIiwiaW52ZW50b3J5IiwiZmF2b3JpdGVzIiwibWxzIiwiR0VUIiwiZGIiLCJ1c2VycyIsImNvbGxlY3Rpb24iLCJmaW5kIiwidG9BcnJheSIsInVzZXJzV2l0aFBlcm1pc3Npb25zIiwibWFwIiwidXNlciIsInBlcm1pc3Npb25zIiwicGFzc3dvcmQiLCJ1bmRlZmluZWQiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJQT1NUIiwicmVxdWVzdCIsInVzZXJEYXRhIiwibmFtZSIsImV4aXN0aW5nVXNlciIsImZpbmRPbmUiLCIkcmVnZXgiLCJSZWdFeHAiLCJyb2xlIiwidG9Mb3dlckNhc2UiLCJjb25zb2xlIiwibG9nIiwiY2hhckF0IiwidG9VcHBlckNhc2UiLCJzbGljZSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsInVwZGF0ZWRBdCIsInNhbHQiLCJnZW5TYWx0IiwiaGFzaCIsInJlc3VsdCIsImluc2VydE9uZSIsImluc2VydGVkSWQiLCJFcnJvciIsInVzZXJXaXRob3V0UGFzc3dvcmQiLCJzdWNjZXNzIiwiX2lkIiwiUFVUIiwiaWQiLCJ1cGRhdGVEYXRhIiwibmV3Um9sZSIsInVwZGF0ZU9uZSIsIiRzZXQiLCJtYXRjaGVkQ291bnQiLCJ1cGRhdGVkVXNlciIsInByb2plY3Rpb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/users/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/mongodb.ts":
/*!************************!*\
  !*** ./lib/mongodb.ts ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_0__);\n\nif (!process.env.MONGODB_URI) {\n    throw new Error(\"Please add your Mongo URI to .env.local\");\n}\nconst uri = process.env.MONGODB_URI;\nconst options = {\n    connectTimeoutMS: 10000,\n    socketTimeoutMS: 45000,\n    serverSelectionTimeoutMS: 5000,\n    maxPoolSize: 10,\n    retryWrites: true,\n    retryReads: true\n};\nlet client;\nlet clientPromise;\nif (true) {\n    // In development mode, use a global variable so that the value\n    // is preserved across module reloads caused by HMR (Hot Module Replacement).\n    let globalWithMongo = global;\n    if (!globalWithMongo._mongoClientPromise) {\n        client = new mongodb__WEBPACK_IMPORTED_MODULE_0__.MongoClient(uri, options);\n        globalWithMongo._mongoClientPromise = client.connect();\n    }\n    clientPromise = globalWithMongo._mongoClientPromise;\n} else {}\nasync function connectToDatabase() {\n    try {\n        const client = await clientPromise;\n        const db = client.db();\n        return {\n            db,\n            client\n        };\n    } catch (error) {\n        console.error(\"MongoDB connection error:\", error);\n        throw error;\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (clientPromise);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvbW9uZ29kYi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQXFDO0FBRXJDLElBQUksQ0FBQ0MsUUFBUUMsR0FBRyxDQUFDQyxXQUFXLEVBQUU7SUFDNUIsTUFBTSxJQUFJQyxNQUFNO0FBQ2xCO0FBRUEsTUFBTUMsTUFBTUosUUFBUUMsR0FBRyxDQUFDQyxXQUFXO0FBQ25DLE1BQU1HLFVBQVU7SUFDZEMsa0JBQWtCO0lBQ2xCQyxpQkFBaUI7SUFDakJDLDBCQUEwQjtJQUMxQkMsYUFBYTtJQUNiQyxhQUFhO0lBQ2JDLFlBQVk7QUFDZDtBQUVBLElBQUlDO0FBQ0osSUFBSUM7QUFFSixJQUFJYixJQUFzQyxFQUFFO0lBQzFDLCtEQUErRDtJQUMvRCw2RUFBNkU7SUFDN0UsSUFBSWMsa0JBQWtCQztJQUl0QixJQUFJLENBQUNELGdCQUFnQkUsbUJBQW1CLEVBQUU7UUFDeENKLFNBQVMsSUFBSWIsZ0RBQVdBLENBQUNLLEtBQUtDO1FBQzlCUyxnQkFBZ0JFLG1CQUFtQixHQUFHSixPQUFPSyxPQUFPO0lBQ3REO0lBQ0FKLGdCQUFnQkMsZ0JBQWdCRSxtQkFBbUI7QUFDckQsT0FBTyxFQUlOO0FBRU0sZUFBZUU7SUFDcEIsSUFBSTtRQUNGLE1BQU1OLFNBQVMsTUFBTUM7UUFDckIsTUFBTU0sS0FBS1AsT0FBT08sRUFBRTtRQUNwQixPQUFPO1lBQUVBO1lBQUlQO1FBQU87SUFDdEIsRUFBRSxPQUFPUSxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyw2QkFBNkJBO1FBQzNDLE1BQU1BO0lBQ1I7QUFDRjtBQUVBLGlFQUFlUCxhQUFhQSxFQUFBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9tb25nb2RiLnRzPzA1YmQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTW9uZ29DbGllbnQgfSBmcm9tIFwibW9uZ29kYlwiXG5cbmlmICghcHJvY2Vzcy5lbnYuTU9OR09EQl9VUkkpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgYWRkIHlvdXIgTW9uZ28gVVJJIHRvIC5lbnYubG9jYWwnKVxufVxuXG5jb25zdCB1cmkgPSBwcm9jZXNzLmVudi5NT05HT0RCX1VSSVxuY29uc3Qgb3B0aW9ucyA9IHtcbiAgY29ubmVjdFRpbWVvdXRNUzogMTAwMDAsIC8vIDEwIHNlY29uZHNcbiAgc29ja2V0VGltZW91dE1TOiA0NTAwMCwgIC8vIDQ1IHNlY29uZHNcbiAgc2VydmVyU2VsZWN0aW9uVGltZW91dE1TOiA1MDAwLCAvLyA1IHNlY29uZHNcbiAgbWF4UG9vbFNpemU6IDEwLFxuICByZXRyeVdyaXRlczogdHJ1ZSxcbiAgcmV0cnlSZWFkczogdHJ1ZVxufVxuXG5sZXQgY2xpZW50OiBNb25nb0NsaWVudFxubGV0IGNsaWVudFByb21pc2U6IFByb21pc2U8TW9uZ29DbGllbnQ+XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gXCJkZXZlbG9wbWVudFwiKSB7XG4gIC8vIEluIGRldmVsb3BtZW50IG1vZGUsIHVzZSBhIGdsb2JhbCB2YXJpYWJsZSBzbyB0aGF0IHRoZSB2YWx1ZVxuICAvLyBpcyBwcmVzZXJ2ZWQgYWNyb3NzIG1vZHVsZSByZWxvYWRzIGNhdXNlZCBieSBITVIgKEhvdCBNb2R1bGUgUmVwbGFjZW1lbnQpLlxuICBsZXQgZ2xvYmFsV2l0aE1vbmdvID0gZ2xvYmFsIGFzIHR5cGVvZiBnbG9iYWxUaGlzICYge1xuICAgIF9tb25nb0NsaWVudFByb21pc2U/OiBQcm9taXNlPE1vbmdvQ2xpZW50PlxuICB9XG5cbiAgaWYgKCFnbG9iYWxXaXRoTW9uZ28uX21vbmdvQ2xpZW50UHJvbWlzZSkge1xuICAgIGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmksIG9wdGlvbnMpXG4gICAgZ2xvYmFsV2l0aE1vbmdvLl9tb25nb0NsaWVudFByb21pc2UgPSBjbGllbnQuY29ubmVjdCgpXG4gIH1cbiAgY2xpZW50UHJvbWlzZSA9IGdsb2JhbFdpdGhNb25nby5fbW9uZ29DbGllbnRQcm9taXNlXG59IGVsc2Uge1xuICAvLyBJbiBwcm9kdWN0aW9uIG1vZGUsIGl0J3MgYmVzdCB0byBub3QgdXNlIGEgZ2xvYmFsIHZhcmlhYmxlLlxuICBjbGllbnQgPSBuZXcgTW9uZ29DbGllbnQodXJpLCBvcHRpb25zKVxuICBjbGllbnRQcm9taXNlID0gY2xpZW50LmNvbm5lY3QoKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29ubmVjdFRvRGF0YWJhc2UoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xpZW50ID0gYXdhaXQgY2xpZW50UHJvbWlzZVxuICAgIGNvbnN0IGRiID0gY2xpZW50LmRiKClcbiAgICByZXR1cm4geyBkYiwgY2xpZW50IH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdNb25nb0RCIGNvbm5lY3Rpb24gZXJyb3I6JywgZXJyb3IpXG4gICAgdGhyb3cgZXJyb3JcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBjbGllbnRQcm9taXNlXG5cbiJdLCJuYW1lcyI6WyJNb25nb0NsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJNT05HT0RCX1VSSSIsIkVycm9yIiwidXJpIiwib3B0aW9ucyIsImNvbm5lY3RUaW1lb3V0TVMiLCJzb2NrZXRUaW1lb3V0TVMiLCJzZXJ2ZXJTZWxlY3Rpb25UaW1lb3V0TVMiLCJtYXhQb29sU2l6ZSIsInJldHJ5V3JpdGVzIiwicmV0cnlSZWFkcyIsImNsaWVudCIsImNsaWVudFByb21pc2UiLCJnbG9iYWxXaXRoTW9uZ28iLCJnbG9iYWwiLCJfbW9uZ29DbGllbnRQcm9taXNlIiwiY29ubmVjdCIsImNvbm5lY3RUb0RhdGFiYXNlIiwiZGIiLCJlcnJvciIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/mongodb.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/bcryptjs"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fusers%2Froute&page=%2Fapi%2Fusers%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fusers%2Froute.ts&appDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fchakrinaidu%2FDesktop%2FGethomerealty-production&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();