"use strict";(()=>{var e={};e.id=5350,e.ids=[5350],e.modules={38013:e=>{e.exports=require("mongodb")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},74457:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>m,originalPathname:()=>y,patchFetch:()=>j,requestAsyncStorage:()=>v,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var o={};t.r(o),t.d(o,{GET:()=>l,POST:()=>p,PUT:()=>u});var a=t(95419),n=t(69108),s=t(99678),i=t(78070),d=t(22345),c=t(38013);async function l(e){try{let{searchParams:r}=new URL(e.url),t=r.get("assignedTo"),o={};t&&(o={assignedTo:t});let{db:a}=await (0,d.v)(),n=await a.collection("leads").find(o).toArray();return i.Z.json(n)}catch(e){return console.error("Error fetching leads:",e),i.Z.json({error:"Failed to fetch leads"},{status:500})}}async function u(e){try{let{id:r,status:t}=await e.json(),{db:o}=await (0,d.v)(),a=await o.collection("leads").findOneAndUpdate({_id:r},{$set:{status:t}},{returnDocument:"after"});if(!a?.value)return i.Z.json({error:"Lead not found"},{status:404});return i.Z.json({success:!0,lead:a.value})}catch(e){return console.error("Update lead error:",e),i.Z.json({error:"Server error"},{status:500})}}async function p(e){try{let r=await e.json(),{db:t}=await (0,d.v)();if(!r.name||!r.email||!r.phone||!r.property)return i.Z.json({error:"Missing required fields"},{status:400});if(r.assignedTo)try{r.assignedTo=new c.ObjectId(r.assignedTo)}catch(e){return i.Z.json({error:"Invalid assignedTo ID"},{status:400})}let o=await t.collection("leads").insertOne(r);if(!o.insertedId)throw Error("Failed to create lead");return i.Z.json({success:!0,lead:{...r,_id:o.insertedId}})}catch(e){return console.error("Error creating lead:",e),i.Z.json({error:"Failed to create lead"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/leads/route",pathname:"/api/leads",filename:"route",bundlePath:"app/api/leads/route"},resolvedPagePath:"/Users/chakrinaidu/Desktop/gethomerealty-verson-2/app/api/leads/route.ts",nextConfigOutput:"standalone",userland:o}),{requestAsyncStorage:v,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:m,staticGenerationBailout:w}=h,y="/api/leads/route";function j(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},22345:(e,r,t)=>{let o;t.d(r,{v:()=>s});var a=t(38013);if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");let n=process.env.MONGODB_URI;async function s(){try{let e=await o;return{db:e.db(),client:e}}catch(e){throw console.error("MongoDB connection error:",e),e}}o=new a.MongoClient(n,{connectTimeoutMS:1e4,socketTimeoutMS:45e3,serverSelectionTimeoutMS:5e3,maxPoolSize:10,retryWrites:!0,retryReads:!0}).connect()}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[1638,6206],()=>t(74457));module.exports=o})();