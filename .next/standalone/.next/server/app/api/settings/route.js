"use strict";(()=>{var e={};e.id=6668,e.ids=[6668],e.modules={38013:e=>{e.exports=require("mongodb")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},68988:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>h,originalPathname:()=>j,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var s={};t.r(s),t.d(s,{GET:()=>c,PATCH:()=>p,PUT:()=>l});var n=t(95419),o=t(69108),a=t(99678),i=t(78070),u=t(22345),d=t(38013);async function c(e){try{let{db:r}=await (0,u.v)(),t=e.headers.get("x-user-id");if(!t)return i.Z.json({error:"User ID is required"},{status:401});let s=await r.collection("users").findOne({_id:new d.ObjectId(t)});if(!s)return i.Z.json({error:"User not found"},{status:404});return i.Z.json({profile:{fullName:s.fullName||"",email:s.email||"",phone:s.phone||"",company:s.company||""},notifications:{newLeads:s.notifications?.newLeads||!1,propertyUpdates:s.notifications?.propertyUpdates||!1,newMessages:s.notifications?.newMessages||!1},preferences:{language:s.preferences?.language||"English",timezone:s.preferences?.timezone||"UTC-5",darkMode:s.preferences?.darkMode||!1}})}catch(e){return console.error("Error fetching settings:",e),i.Z.json({error:"Failed to fetch settings"},{status:500})}}async function p(e){try{let{db:r}=await (0,u.v)(),t=e.headers.get("x-user-id"),s=await e.json();if(!t)return i.Z.json({error:"User ID is required"},{status:401});let n={};if(s.profile&&(n.fullName=s.profile.fullName,n.email=s.profile.email,n.phone=s.profile.phone,n.company=s.profile.company),s.notifications&&(n.notifications={newLeads:s.notifications.newLeads,propertyUpdates:s.notifications.propertyUpdates,newMessages:s.notifications.newMessages}),s.preferences&&(n.preferences={language:s.preferences.language,timezone:s.preferences.timezone,darkMode:s.preferences.darkMode}),0===Object.keys(n).length)return i.Z.json({error:"No valid updates provided"},{status:400});let o=await r.collection("users").updateOne({_id:new d.ObjectId(t)},{$set:n});if(0===o.matchedCount)return i.Z.json({error:"User not found"},{status:404});return i.Z.json({message:"Settings updated successfully"})}catch(e){return console.error("Error updating settings:",e),i.Z.json({error:"Failed to update settings"},{status:500})}}async function l(e){try{let{db:r}=await (0,u.v)(),t=e.headers.get("x-user-id"),{currentPassword:s,newPassword:n}=await e.json();if(!t)return i.Z.json({error:"User ID is required"},{status:401});if(!s||!n)return i.Z.json({error:"Current and new passwords are required"},{status:400});if(!await r.collection("users").findOne({_id:new d.ObjectId(t)}))return i.Z.json({error:"User not found"},{status:404});let o=await r.collection("users").updateOne({_id:new d.ObjectId(t)},{$set:{password:n}});if(0===o.matchedCount)return i.Z.json({error:"User not found"},{status:404});return i.Z.json({message:"Password updated successfully"})}catch(e){return console.error("Error updating password:",e),i.Z.json({error:"Failed to update password"},{status:500})}}let f=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/settings/route",pathname:"/api/settings",filename:"route",bundlePath:"app/api/settings/route"},resolvedPagePath:"/Users/chakrinaidu/Desktop/Gethomerealty-production/app/api/settings/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:m,serverHooks:w,headerHooks:h,staticGenerationBailout:y}=f,j="/api/settings/route";function v(){return(0,a.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},22345:(e,r,t)=>{let s;t.d(r,{v:()=>a});var n=t(38013);if(!process.env.MONGODB_URI)throw Error("Please add your Mongo URI to .env.local");let o=process.env.MONGODB_URI;async function a(){try{let e=await s;return{db:e.db(),client:e}}catch(e){throw console.error("MongoDB connection error:",e),e}}s=new n.MongoClient(o,{connectTimeoutMS:1e4,socketTimeoutMS:45e3,serverSelectionTimeoutMS:5e3,maxPoolSize:10,retryWrites:!0,retryReads:!0}).connect()}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[1638,6206],()=>t(68988));module.exports=s})();